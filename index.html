<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <link rel="stylesheet" href="./site.css">
</head>
<body>
    <section id="main">

    </section>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded',initializeQuiz);
        // document.addEventListener('DOMContentLoaded',readTextFile("https://drive.google.com/file/d/1MARx3Cb7oHzZBTVzbhqYfIyBqkcE9IO0/view?usp=sharing", 
        // function(text){ var data = JSON.parse(text); console.log(data); initializeQuiz();}));
        var curUser = "";
        var questionCount = 1;
        var pickedAnswers = [];
        var correctAnswers = [];
        var correctCount = 0;
        var notAnswered = 0;
        var idcheck = [];

        /////
        var questions = [
            {
                "question_no" : 1 ,
                "qname"    : "first",
                "options"     : [ "pk","gk","ck","dk"],
                "correct"    : 1
            },
            {
                "question_no" : 2 ,
                "qname"    : "what is the name of cm?",
                "options"     : [ "p","g","c","d"],
                "correct"     : 2
            },
            {
                "question_no" : 3 ,
                "qname"    : "third?",
                "options"     : [ "t","h","r","ee"],
                "correct"    : 1
            },
            {
                "question_no" : 4 ,
                "qname"    : "fourth",
                "options"     : [ "f","o","u","r"],
                "correct"     : 3
            },
            {
                "question_no" : 5 ,
                "qname"    : "fifth",
                "options"     : [ "f","i","v","e"],
                "correct"     : 1
            },
            {
                "question_no" : 6 ,
                "qname"    : "sixth",
                "options"     : [ "s","i","x","x"],
                "correct"     : 4
            },
            {
                "question_no" : 7 ,
                "qname"    : "seventh",
                "options"     : [ "s","e","v","en"],
                "correct"     : 1
            },
            {
                "question_no" : 8 ,
                "qname"    : "eighth",
                "options"     : [ "e","i","g","ht"],
                "correct"     : 2
            },
            {
                "question_no" : 9 ,
                "qname"    : "nineth",
                "options"     : [ "n","i","n","e"],
                "correct"     : 1
            },
            {
                "question_no" : 10 ,
                "qname"    : "tenth",
                "options"     : [ "t","e","n","n"],
                "correct"     : 3
            }
        ]
        // function readTextFile(file, callback) {
        //     var rawFile = new XMLHttpRequest();
        //     rawFile.overrideMimeType("application/json");
        //     rawFile.open("GET", file, true);
        //     rawFile.onreadystatechange = function() {
        //         if (rawFile.readyState === 4 && rawFile.status == "200") {
        //             callback(rawFile.response);
        //         }
        //     }
        //     rawFile.send(null);
        // }
        
        function initializeQuiz() {
            document.getElementById('main').innerHTML='<div id="quizWrapper"></div>';
            console.log(document.getElementById('main').value);
            renderInputs();      
        }

        function renderInputs() {
            var mainEle = document.getElementById('quizWrapper');
            mainEle.innerHTML='<input id="userName" placeholder="Enter Your Name"/><br> <button id="enterButton"> Enter Quiz </button>';

            //listener to input field// 
            document.getElementById('userName').addEventListener('change',() => {
                curUser += document.getElementById('userName').value;
            })

           // pushing correctAnswers from file to array
            for(var x in questions) 
                     correctAnswers.push(questions[x].correct);
                    
            //console.log(correctAnswers);

            //listener to button
            document.getElementById('enterButton').addEventListener('click', ()=> {
                //console.log("curuser is "+curUser);
                if(curUser == "") {
                    mainEle.innerHTML += '<br><p id="errorText">Please enter a valid username</p>'; 
                    setTimeout(()=>document.getElementById('errorText').innerHTML = "",3000);
                    setTimeout(renderInputs,3000);
                    }
                else {
                    loadQuestions();
                }
            })
        };


        function loadQuestions() {
            var mainEle = document.getElementById('quizWrapper');
            mainEle.innerHTML = '<p id="welcomeText"> Hello '+curUser+' here is your quiz ! Good Luck :)</p>';
            mainEle.innerHTML += '<p id= "question"></p><br><div id="optionWrapper"></div>';
            showQuestion();
            mainEle.innerHTML += '<button id="prevQuestion">Previous</button><button id="nextQuestion">Next</button>'

            //listener to next button //
            document.getElementById('nextQuestion').addEventListener('click', ()=> {

                if(questionCount == 10) {
                    mainEle.innerHTML += '<p>This is the last question please submit !<br>';
                    mainEle.innerHTML += '<button id="submit">SUBMIT</button>';
                    addListenerToSubmit();
                }
                else {
                    pushAnswerSelected();
                    document.getElementById('optionWrapper').innerHTML= "";
                    showQuestion(questionCount++);
                }
            });

        }

        function showQuestion() {
            var optionWrap = document.getElementById('optionWrapper');
            var curQues;
            for(x in questions) 
                {  //console.log(questions[x]);
                    if(questions[x].question_no == questionCount)
                    {
                        curQues = questions[x];
                        //console.log(curQues);
                        break;
                    }
                }
            document.getElementById('question').innerHTML = curQues.qname;
            curQues.options.map((val,key)=> {
                optionWrap.innerHTML += '<input type="radio" id ='+parseInt(key+1)+' name="optiongroup"/><label for='+key+'>'+val+'</span<br>';
                
            });

        }



        function pushAnswerSelected() {
            if(document.getElementById('1').checked)
                pickedAnswers.push(1);
            else if(document.getElementById('2').checked)
                pickedAnswers.push(2);
            else if(document.getElementById('3').checked)
                pickedAnswers.push(3);
            else if(document.getElementById('4').checked)
                pickedAnswers.push(4);
            else
                pickedAnswers.push(-1);
                
            if(pickedAnswers[questionCount-1] == correctAnswers[questionCount-1])
               { 
                   correctCount++;
                   idcheck.push('correctCheck')
               }
            else if(pickedAnswers[questionCount-1] == -1)
               {
                   notAnswered++;
                   idcheck.push('notansCheck');
               }
            else {
                   idcheck.push('wrongCheck');
                }
            console.log(pickedAnswers);
            console.log(correctCount);
            console.log(notAnswered);
        }


        function addListenerToSubmit() {

            document.getElementById('submit').addEventListener('click',()=> {
                var mainEle = document.getElementById('quizWrapper');
                mainEle.innerHTML = '<p id="reportHead">'+curUser+', here is your report !</p><br>'
                
                var output1 = ['correctSub','wrongSub','notansSub'];
                var output2 = [correctCount,10-correctCount-notAnswered,notAnswered];

                for(var i =0;i <3;i++) 
                    mainEle.innerHTML += '<div id='+output1[i]+'>'+output2[i]+'</div>';


                mainEle.innerHTML += '<br><p id="detailsLink">View Details !<br></p>';
                mainEle.innerHTML += '<br><button id="retakeButton">Retake Quiz</button>'

                document.getElementById('detailsLink').addEventListener('click',()=>{

                idcheck.map((id,key)=>{
                    document.getElementById('detailsLink').innerHTML += '<div id='+id+'>'+key+'</div>';
                });
                });
                
                
            });
        }


    </script>
</body>
</html>